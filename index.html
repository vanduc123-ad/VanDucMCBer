<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hỗ trợ MCBE | VanDucMCBer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; background: #05070a; color: #e2e8f0; margin: 0; }
        .glass { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .btn-primary { background: #10b981; color: #000; font-weight: 800; border-radius: 12px; }
        .card-item { background: #0d1117; border: 1px solid #1f2937; border-radius: 20px; }
        #loading-screen { position: fixed; inset: 0; background: #05070a; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="w-10 h-10 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"></div>
        <p class="mt-4 text-[10px] text-emerald-500 font-bold uppercase tracking-widest">Đang kết nối Cloud...</p>
    </div>

    <nav class="sticky top-0 z-50 glass px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center text-black">
                <i class="fas fa-cube"></i>
            </div>
            <h1 class="text-lg font-bold uppercase">VANDUC<span class="text-emerald-500">MCBER</span></h1>
        </div>
        <button onclick="toggleModal(true)" class="btn-primary px-4 py-2 text-[10px] uppercase">Đăng Pack</button>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-10 text-center">
        <div id="pack-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Data from Firebase -->
        </div>
    </main>

    <div id="upload-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/90">
        <div class="bg-[#0d1117] w-full max-w-md rounded-2xl p-6 border border-white/10">
            <h3 class="text-emerald-500 font-bold mb-6 uppercase text-sm">Đăng bản hỗ trợ mới</h3>
            <form id="upload-form" class="space-y-4 text-left">
                <input type="text" id="p-name" placeholder="Tên Pack (Ví dụ: §aAddon §bBay)" required class="w-full bg-[#161b22] border border-[#30363d] p-3 rounded-lg text-white outline-none">
                <select id="p-type" class="w-full bg-[#161b22] border border-[#30363d] p-3 rounded-lg text-white">
                    <option value="mcaddon">.mcaddon</option>
                    <option value="mcpack">.mcpack</option>
                    <option value="link">Dán link</option>
                </select>
                <input type="file" id="p-file" class="text-xs text-emerald-500 font-bold">
                <textarea id="p-desc" placeholder="Hướng dẫn sử dụng..." required class="w-full bg-[#161b22] border border-[#30363d] p-3 rounded-lg text-white h-24"></textarea>
                <button type="submit" id="submit-btn" class="w-full btn-primary py-3 uppercase text-xs">Xác nhận</button>
            </form>
            <button onclick="toggleModal(false)" class="w-full mt-4 text-slate-500 text-xs uppercase">Hủy</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCZQLYjtjCTh-7LQSlDQw4zFEYZyIHYxL4",
            authDomain: "vanducmcber-library.firebaseapp.com",
            projectId: "vanducmcber-library",
            storageBucket: "vanducmcber-library.firebasestorage.app",
            messagingSenderId: "553578476047",
            appId: "1:553578476047:web:c1772fb9bbdb1e8417697a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        signInAnonymously(auth);
        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('loading-screen').style.display = 'none';
                const q = query(collection(db, 'artifacts', 'v3_final', 'public', 'data', 'packs'), orderBy('createdAt', 'desc'));
                onSnapshot(q, (snap) => {
                    const list = document.getElementById('pack-list');
                    list.innerHTML = '';
                    snap.docs.forEach(doc => {
                        const d = doc.data();
                        const el = document.createElement('div');
                        el.className = 'card-item p-5 text-left';
                        el.innerHTML = `
                            <span class="bg-emerald-500 text-[8px] font-black text-black px-2 py-0.5 rounded uppercase mb-2 inline-block">${d.type}</span>
                            <h4 class="font-bold text-white mb-1 truncate">${d.name}</h4>
                            <p class="text-[10px] text-slate-500 mb-4 line-clamp-2">${d.description}</p>
                            <button onclick="window.open('${d.fileData || d.link}')" class="w-full bg-white/5 hover:bg-emerald-500 hover:text-black py-2 rounded-lg text-black font-bold text-[10px] uppercase transition-all">Tải Pack</button>
                        `;
                        list.appendChild(el);
                    });
                });
            }
        });

        document.getElementById('upload-form').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.disabled = true; btn.innerText = "ĐANG TẢI...";
            const file = document.getElementById('p-file').files[0];
            let b64 = null;
            if(file) b64 = await new Promise(r => { const fr = new FileReader(); fr.readAsDataURL(file); fr.onload = () => r(fr.result); });

            await addDoc(collection(db, 'artifacts', 'v3_final', 'public', 'data', 'packs'), {
                name: document.getElementById('p-name').value,
                type: document.getElementById('p-type').value,
                description: document.getElementById('p-desc').value,
                fileData: b64, createdAt: serverTimestamp()
            });
            toggleModal(false);
            btn.disabled = false; btn.innerText = "Xác nhận";
        };

        window.toggleModal = (s) => document.getElementById('upload-modal').classList.toggle('hidden', !s);
    </script>
</body>
</html>

                  
